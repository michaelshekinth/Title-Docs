{"root":{"children":[{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Smart Contracts","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h1","id":"smart-contracts"},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Smart Contract Suite (Overview)","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h1","id":"smart-contract-suite-(overview)"},{"children":[{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"MarketFactory","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – deploys new markets (binary/multi/scalar) and wires dependencies.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":1},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"MarketRegistry","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – index of all markets with metadata (creator, category, status).","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":2},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"PredictionMarket (per market instance)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – core trading & lifecycle: buy/sell, lock, resolve, claim.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":3},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"OutcomeToken (ERC‑1155)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – position tokens (e.g., YES/NO) per market; minted on buy, burned on sell/claim.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":4},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"AMM Pool (optional)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – automated pricing & liquidity (if AMM mode is used instead of order book settlement).","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":5},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Treasury","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – collects protocol fees and can distribute incentives.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":6},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"OracleAdapter","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – pulls/accepts outcomes from chosen oracle (e.g., Chainlink/UMA) with a standard interface.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":7},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"DisputeModule","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – time‑boxed challenge flow; bond staking and finalize outcome.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":8},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Account Abstraction Paymaster (optional)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" – sponsors gas or lets users pay gas in USDC. ","type":"text","version":1},{"detail":0,"format":2,"mode":"normal","style":"","text":"(4337 infra, not core to markets)","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":9}],"direction":"ltr","format":"","indent":0,"type":"list","version":1,"listType":"number","start":1,"tag":"ol"},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"How They’re Used (Key Use Cases)","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h2","id":"how-they're-used-(key-use-cases)"},{"children":[{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Create Market (Factory + Registry + Market):","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"Creator calls ","type":"text","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"MarketFactory.createMarket(...)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" → new ","type":"text","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"PredictionMarket","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" deployed → registered in ","type":"text","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"MarketRegistry","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":".","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"Initial parameters: question, outcomes, endTime, oracle feed, collateral token, AMM mode (on/off), fees.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":1},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Trade YES/NO (Market + OutcomeToken + AMM):","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"User ","type":"text","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"buy(outcome, amount)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" → collateral transferred to market → AMM swap (or order‑book settlement) → ERC‑1155 outcome tokens minted to user (or their Proxy Wallet).","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"sell(outcome, amount)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":" burns ERC‑1155; returns USDC minus fees.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":2},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Lock & Resolve (Market + OracleAdapter + Dispute):","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"At ","type":"text","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"endTime","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":", market locks trading. OracleAdapter posts result via ","type":"text","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"reportOutcome(winner)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":".","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"If challenged, DisputeModule handles staking & adjudication; then ","type":"text","version":1},{"detail":0,"format":16,"mode":"normal","style":"","text":"finalizeOutcome(winner)","type":"text","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":".","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":3},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Claim (Market + OutcomeToken + Treasury):","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"Holders of the winning ERC‑1155 burn positions to claim USDC. Treasury takes protocol fee if configured.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":4},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Fees & Rewards (Treasury):","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"Protocol fee on trades or claims flows into Treasury; can fund LP incentives or buybacks later.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":5},{"children":[{"detail":0,"format":1,"mode":"normal","style":"","text":"Gas UX (Paymaster):","type":"text","version":1},{"type":"linebreak","version":1},{"detail":0,"format":0,"mode":"normal","style":"","text":"Optional ERC‑4337 Paymaster sponsors gas or charges gas in USDC for bundles (approve→buy→record).","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"listitem","version":1,"value":6}],"direction":"ltr","format":"","indent":0,"type":"list","version":1,"listType":"bullet","start":1,"tag":"ul"},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Collateral (ERC‑20), IPositions (ERC‑1155) ( SAMPLE CODE STRUCTURE )","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h3","id":"collateral-(erc20)-ipositions-(erc1155)-(-sample-code-structure-)"},{"codeSrc":"// SPDX-License-Identifier: MIT\npragma solidity ^0.8.20;\n\ninterface ICollateral {\n    function transferFrom(address from, address to, uint256 amt) external returns (bool);\n    function transfer(address to, uint256 amt) external returns (bool);\n    function balanceOf(address) external view returns (uint256);\n    function decimals() external view returns (uint8);\n}\n\ninterface IPositions /* is ERC1155-like */ {\n    function mint(address to, uint256 id, uint256 amt, bytes calldata data) external;\n    function burn(address from, uint256 id, uint256 amt) external;\n}\n","language":"shellscript","languageTitle":"Shell","codeHtml":"<pre class=\"shiki shiki-themes github-light-default github-dark-default\" style=\"background-color:#f1f5f9;--shiki-dark-bg:#0d1117;color:#1f2328;--shiki-dark:#e6edf3\" tabindex=\"0\"><code class=\"code-view\"><span class=\"line\" data-line=\"1\"><span style=\"color:#953800;--shiki-dark:#FFA657\">//</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> SPDX-License-Identifier:</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MIT</span></span>\n<span class=\"line\" data-line=\"2\"><span style=\"color:#953800;--shiki-dark:#FFA657\">pragma</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> solidity</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ^0.8.20</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"3\"></span>\n<span class=\"line\" data-line=\"4\"><span style=\"color:#953800;--shiki-dark:#FFA657\">interface</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ICollateral</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"5\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> transferFrom</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> from,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> to,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> amt</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> returns</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> (bool);</span></span>\n<span class=\"line\" data-line=\"6\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> transfer</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> to,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> amt</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> returns</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> (bool);</span></span>\n<span class=\"line\" data-line=\"7\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> balanceOf</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">address</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> view</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> returns</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> (uint256);</span></span>\n<span class=\"line\" data-line=\"8\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> decimals</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">() external view returns (</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint8</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"9\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">}</span></span>\n<span class=\"line\" data-line=\"10\"></span>\n<span class=\"line\" data-line=\"11\"><span style=\"color:#953800;--shiki-dark:#FFA657\">interface</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> IPositions</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> /</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\">*</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> is</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ERC1155-like</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> *</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">/</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"12\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> mint</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> to,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> id,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> amt,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> bytes</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> calldata</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> data</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"13\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> burn</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> from,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> id,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> amt</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"14\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">}</span></span>\n<span class=\"line\" data-line=\"15\"></span>\n<span class=\"line\" data-line=\"16\"></span></code></pre>","height":"427.125px","type":"code-block","version":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"Market Types & Oracle Interface","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h3","id":"market-types-and-oracle-interface"},{"codeSrc":"pragma solidity ^0.8.20;\n\ninterface IOracleAdapter {\n    event OutcomeProposed(uint256 marketId, uint256 outcomeId, address proposer);\n    event OutcomeFinalized(uint256 marketId, uint256 outcomeId);\n\n    function proposeOutcome(uint256 marketId, uint256 outcomeId) external;\n    function finalizeOutcome(uint256 marketId) external;\n    function getOutcome(uint256 marketId) external view returns (bool finalized, uint256 outcomeId);\n}\n","language":"shellscript","languageTitle":"Shell","codeHtml":"<pre class=\"shiki shiki-themes github-light-default github-dark-default\" style=\"background-color:#f1f5f9;--shiki-dark-bg:#0d1117;color:#1f2328;--shiki-dark:#e6edf3\" tabindex=\"0\"><code class=\"code-view\"><span class=\"line\" data-line=\"1\"><span style=\"color:#953800;--shiki-dark:#FFA657\">pragma</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> solidity</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ^0.8.20</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"2\"></span>\n<span class=\"line\" data-line=\"3\"><span style=\"color:#953800;--shiki-dark:#FFA657\">interface</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> IOracleAdapter</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"4\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    event</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> OutcomeProposed</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> outcomeId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> proposer</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"5\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    event</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> OutcomeFinalized</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> outcomeId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"6\"></span>\n<span class=\"line\" data-line=\"7\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> proposeOutcome</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> outcomeId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"8\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> finalizeOutcome</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"9\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> getOutcome</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> view</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> returns</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> (bool </span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">finalized,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> outcomeId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"10\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">}</span></span>\n<span class=\"line\" data-line=\"11\"></span>\n<span class=\"line\" data-line=\"12\"></span></code></pre>","height":"326.344px","type":"code-block","version":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"MarketRegistry","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h3","id":"marketregistry"},{"codeSrc":"pragma solidity ^0.8.20;\n\ncontract MarketRegistry {\n    struct MarketInfo {\n        address market;\n        address creator;\n        string  category;\n        uint64  endTime;\n        bool    resolved;\n    }\n\n    MarketInfo[] public markets;\n    event MarketRegistered(uint256 indexed marketId, address market, address creator, string category, uint64 endTime);\n\n    function register(address market, address creator, string calldata category, uint64 endTime) external returns (uint256 id) {\n        markets.push(MarketInfo(market, creator, category, endTime, false));\n        id = markets.length - 1;\n        emit MarketRegistered(id, market, creator, category, endTime);\n    }\n\n    function setResolved(uint256 id) external { // restrict in production\n        markets[id].resolved = true;\n    }\n\n    function getCount() external view returns (uint256) { return markets.length; }\n}\n","language":"shellscript","languageTitle":"Shell","codeHtml":"<pre class=\"shiki shiki-themes github-light-default github-dark-default\" style=\"background-color:#f1f5f9;--shiki-dark-bg:#0d1117;color:#1f2328;--shiki-dark:#e6edf3\" tabindex=\"0\"><code class=\"code-view\"><span class=\"line\" data-line=\"1\"><span style=\"color:#953800;--shiki-dark:#FFA657\">pragma</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> solidity</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ^0.8.20</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"2\"></span>\n<span class=\"line\" data-line=\"3\"><span style=\"color:#953800;--shiki-dark:#FFA657\">contract</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketRegistry</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"4\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    struct</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketInfo</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"5\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> market</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"6\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> creator</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"7\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        string</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">  category</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"8\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        uint64</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">  endTime</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"9\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        bool</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">    resolved</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"10\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"11\"></span>\n<span class=\"line\" data-line=\"12\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    MarketInfo[]</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> markets</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"13\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    event</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketRegistered</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> indexed</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> creator,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> string</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> category,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint64</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> endTime</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"14\"></span>\n<span class=\"line\" data-line=\"15\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> register</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> creator,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> string</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> calldata</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> category,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint64</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> endTime</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> returns</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> (uint256 </span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">id</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) {</span></span>\n<span class=\"line\" data-line=\"16\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        markets.push(MarketInfo(market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> creator,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> category,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> endTime,</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> false</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">));</span></span>\n<span class=\"line\" data-line=\"17\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        id</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> markets.length</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> -</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> 1</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"18\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        emit</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketRegistered</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">id,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> creator,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> category,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> endTime</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"19\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"20\"></span>\n<span class=\"line\" data-line=\"21\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> setResolved</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> id</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) external { </span><span style=\"color:#953800;--shiki-dark:#FFA657\">//</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> restrict</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> in</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> production</span></span>\n<span class=\"line\" data-line=\"22\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        markets[id].resolved</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> true</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"23\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"24\"></span>\n<span class=\"line\" data-line=\"25\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> getCount</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">() external view returns (</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) { </span><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">return</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> markets.length</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">; }</span></span>\n<span class=\"line\" data-line=\"26\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">}</span></span>\n<span class=\"line\" data-line=\"27\"></span>\n<span class=\"line\" data-line=\"28\"></span></code></pre>","height":"729.469px","type":"code-block","version":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"MarketFactory","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h2","id":"marketfactory"},{"codeSrc":"pragma solidity ^0.8.20;\n\nimport \"./MarketRegistry.sol\";\nimport \"./PredictionMarket.sol\";\n\ncontract MarketFactory {\n    MarketRegistry public registry;\n    address public oracleAdapter;\n    address public positionsImpl;  // ERC-1155 positions (cloneable)\n    address public collateral;     // e.g., USDC\n    address public treasury;\n\n    event MarketCreated(uint256 indexed marketId, address market, string question);\n\n    constructor(address _registry, address _oracle, address _positions, address _collateral, address _treasury) {\n        registry = MarketRegistry(_registry);\n        oracleAdapter = _oracle;\n        positionsImpl = _positions;\n        collateral = _collateral;\n        treasury = _treasury;\n    }\n\n    function createBinary(\n        string calldata question,\n        string calldata category,\n        uint64 endTime,\n        uint16 feeBps,\n        bool useAMM\n    ) external returns (address market, uint256 marketId) {\n        PredictionMarket m = new PredictionMarket(\n            question, category, endTime, feeBps,\n            collateral, oracleAdapter, treasury, useAMM\n        );\n        market = address(m);\n        marketId = registry.register(market, msg.sender, category, endTime);\n        m.setIds(marketId, 2 /* outcomes: YES=1, NO=2 */);\n        emit MarketCreated(marketId, market, question);\n    }\n}\n","language":"shellscript","languageTitle":"Shell","codeHtml":"<pre class=\"shiki shiki-themes github-light-default github-dark-default\" style=\"background-color:#f1f5f9;--shiki-dark-bg:#0d1117;color:#1f2328;--shiki-dark:#e6edf3\" tabindex=\"0\"><code class=\"code-view\"><span class=\"line\" data-line=\"1\"><span style=\"color:#953800;--shiki-dark:#FFA657\">pragma</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> solidity</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ^0.8.20</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"2\"></span>\n<span class=\"line\" data-line=\"3\"><span style=\"color:#953800;--shiki-dark:#FFA657\">import</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> \"./MarketRegistry.sol\"</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"4\"><span style=\"color:#953800;--shiki-dark:#FFA657\">import</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> \"./PredictionMarket.sol\"</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"5\"></span>\n<span class=\"line\" data-line=\"6\"><span style=\"color:#953800;--shiki-dark:#FFA657\">contract</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketFactory</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"7\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    MarketRegistry</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> registry</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"8\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> oracleAdapter</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"9\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> positionsImpl</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;  </span><span style=\"color:#953800;--shiki-dark:#FFA657\">//</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ERC-1155</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> positions</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> (cloneable)</span></span>\n<span class=\"line\" data-line=\"10\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> collateral</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;     </span><span style=\"color:#953800;--shiki-dark:#FFA657\">//</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> e.g.,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> USDC</span></span>\n<span class=\"line\" data-line=\"11\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> treasury</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"12\"></span>\n<span class=\"line\" data-line=\"13\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    event</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketCreated</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> indexed</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> string</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> question</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"14\"></span>\n<span class=\"line\" data-line=\"15\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    constructor(address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _registry,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _oracle,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _positions,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _collateral,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _treasury</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) {</span></span>\n<span class=\"line\" data-line=\"16\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        registry</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketRegistry</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">_registry</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"17\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        oracleAdapter</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _oracle</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"18\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        positionsImpl</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _positions</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"19\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        collateral</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _collateral</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"20\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        treasury</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> _treasury</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"21\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"22\"></span>\n<span class=\"line\" data-line=\"23\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> createBinary</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span></span>\n<span class=\"line\" data-line=\"24\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        string</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> calldata</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> question,</span></span>\n<span class=\"line\" data-line=\"25\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        string</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> calldata</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> category,</span></span>\n<span class=\"line\" data-line=\"26\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        uint64</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> endTime,</span></span>\n<span class=\"line\" data-line=\"27\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        uint16</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> feeBps,</span></span>\n<span class=\"line\" data-line=\"28\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        bool</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> useAMM</span></span>\n<span class=\"line\" data-line=\"29\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    ) external returns (</span><span style=\"color:#953800;--shiki-dark:#FFA657\">address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) {</span></span>\n<span class=\"line\" data-line=\"30\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        PredictionMarket</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> m</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> new</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> PredictionMarket</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span></span>\n<span class=\"line\" data-line=\"31\"><span style=\"color:#953800;--shiki-dark:#FFA657\">            question,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> category,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> endTime,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> feeBps,</span></span>\n<span class=\"line\" data-line=\"32\"><span style=\"color:#953800;--shiki-dark:#FFA657\">            collateral,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> oracleAdapter,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> treasury,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> useAMM</span></span>\n<span class=\"line\" data-line=\"33\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">        );</span></span>\n<span class=\"line\" data-line=\"34\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        market</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">m</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"35\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        marketId</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> registry.register</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> msg.sender,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> category,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> endTime</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"36\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        m.setIds(marketId,</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> 2</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> /</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\">*</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> outcomes:</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> YES=1,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> NO=</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\">2</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> *</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">/</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"37\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        emit</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> MarketCreated</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> market,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> question</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"38\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"39\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">}</span></span>\n<span class=\"line\" data-line=\"40\"></span>\n<span class=\"line\" data-line=\"41\"></span></code></pre>","height":"1057.01px","type":"code-block","version":1},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"DisputeModule (skeleton)","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"toc-heading","version":1,"tag":"h3","id":"disputemodule-(skeleton)"},{"codeSrc":"pragma solidity ^0.8.20;\n\ncontract DisputeModule {\n    struct Dispute {\n        address challenger;\n        uint256 bond;\n        uint64  openedAt;\n        bool    resolved;\n    }\n    mapping(uint256 => Dispute) public disputes; // marketId => dispute\n    uint64 public constant WINDOW = 24 hours;\n    uint256 public constant BOND = 100e6; // 100 USDC (example)\n\n    event Disputed(uint256 marketId, address challenger);\n    event DisputeResolved(uint256 marketId, bool uphold);\n\n    function open(uint256 marketId) external {\n        require(disputes[marketId].challenger == address(0), \"exists\");\n        disputes[marketId] = Dispute(msg.sender, BOND, uint64(block.timestamp), false);\n        emit Disputed(marketId, msg.sender);\n    }\n\n    function resolve(uint256 marketId, bool uphold) external {\n        Dispute storage d = disputes[marketId];\n        require(!d.resolved && block.timestamp <= d.openedAt + WINDOW, \"closed\");\n        d.resolved = true;\n        emit DisputeResolved(marketId, uphold);\n    }\n}\n","language":"shellscript","languageTitle":"Shell","codeHtml":"<pre class=\"shiki shiki-themes github-light-default github-dark-default\" style=\"background-color:#f1f5f9;--shiki-dark-bg:#0d1117;color:#1f2328;--shiki-dark:#e6edf3\" tabindex=\"0\"><code class=\"code-view\"><span class=\"line\" data-line=\"1\"><span style=\"color:#953800;--shiki-dark:#FFA657\">pragma</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> solidity</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ^0.8.20</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"2\"></span>\n<span class=\"line\" data-line=\"3\"><span style=\"color:#953800;--shiki-dark:#FFA657\">contract</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> DisputeModule</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"4\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    struct</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> Dispute</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"5\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> challenger</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"6\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> bond</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"7\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        uint64</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">  openedAt</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"8\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        bool</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">    resolved</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"9\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"10\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    mapping(uint256</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> =</span><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">></span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> Dispute</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) public disputes; </span><span style=\"color:#953800;--shiki-dark:#FFA657\">//</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> =</span><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">></span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> dispute</span></span>\n<span class=\"line\" data-line=\"11\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    uint64</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> constant</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> WINDOW</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> 24</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> hours</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"12\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> public</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> constant</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> BOND</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> 100e6</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">; </span><span style=\"color:#953800;--shiki-dark:#FFA657\">//</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> 100</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> USDC</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> (example)</span></span>\n<span class=\"line\" data-line=\"13\"></span>\n<span class=\"line\" data-line=\"14\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    event</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> Disputed</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> challenger</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"15\"><span style=\"color:#953800;--shiki-dark:#FFA657\">    event</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> DisputeResolved</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> bool</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uphold</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"16\"></span>\n<span class=\"line\" data-line=\"17\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> open</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) </span><span style=\"color:#953800;--shiki-dark:#FFA657\">external</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> {</span></span>\n<span class=\"line\" data-line=\"18\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        require(disputes[marketId].challenger</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> ==</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> address</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">0</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">)</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> \"exists\"</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"19\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        disputes[marketId]</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> Dispute</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">msg.sender,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> BOND,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uint64</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">block.timestamp</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">)</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">,</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> false</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"20\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        emit</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> Disputed</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> msg.sender</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"21\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"22\"></span>\n<span class=\"line\" data-line=\"23\"><span style=\"color:#CF222E;--shiki-dark:#FF7B72\">    function</span><span style=\"color:#8250DF;--shiki-dark:#D2A8FF\"> resolve</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">uint256</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> bool</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uphold</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">) external {</span></span>\n<span class=\"line\" data-line=\"24\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        Dispute</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> storage</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> d</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> disputes[marketId]</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"25\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        require(!d.resolved</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\"> &#x26;&#x26; </span><span style=\"color:#953800;--shiki-dark:#FFA657\">block.timestamp</span><span style=\"color:#CF222E;--shiki-dark:#FF7B72\"> &#x3C;</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\">=</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> d.openedAt</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> +</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> WINDOW,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> \"closed\"</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"26\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        d.resolved</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> =</span><span style=\"color:#0550AE;--shiki-dark:#79C0FF\"> true</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">;</span></span>\n<span class=\"line\" data-line=\"27\"><span style=\"color:#953800;--shiki-dark:#FFA657\">        emit</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> DisputeResolved</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">(</span><span style=\"color:#953800;--shiki-dark:#FFA657\">marketId,</span><span style=\"color:#0A3069;--shiki-dark:#A5D6FF\"> uphold</span><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">);</span></span>\n<span class=\"line\" data-line=\"28\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">    }</span></span>\n<span class=\"line\" data-line=\"29\"><span style=\"color:#1F2328;--shiki-dark:#E6EDF3\">}</span></span>\n<span class=\"line\" data-line=\"30\"></span>\n<span class=\"line\" data-line=\"31\"></span></code></pre>","height":"805.055px","type":"code-block","version":1}],"direction":"ltr","format":"","indent":0,"type":"root","version":1}}